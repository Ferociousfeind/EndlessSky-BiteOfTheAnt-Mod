# Copyright (c) 2016 by Keegan Taylor
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

mission "Cloak Check 1"
	invisible
	to offer
		has "main plot completed"
		has "Land at Atilt San Pug 1: done"
	on offer
		require "Cloaking Device" 1
		event "has 1 real cloak"
		fail

event "has 1 real cloak"

mission "Cloak Check 2"
	invisible
	to offer
		has "main plot completed"
		has "UPStock Cloaking Device available"
		has "Land at Atilt San Pug 1: done"
	on offer
		require "Cloaking Device" 2
		event "has 2 real cloaks"
		fail

event "has 2 real cloaks"

mission "Cloak Check 3"
	invisible
	to offer
		has "main plot completed"
		has "Land at Atilt San Pug 1: done"
	on offer
		require Civilian Cloaking Device 1
		event "has 1 civ cloak"
		fail

event "has 1 civ cloak"

mission "Cloak Check 4"
	invisible
	to offer
		has "main plot completed"
		has "Land at Atilt San Pug 1: done"
	on offer
		require Civilian Cloaking Device 2
		event "has 2 civ cloaks"
		fail

event "has 2 civ cloaks"

mission "Drak guarding Chordi"
	invisible
	landing
	on enter Chordi
		dialog 'Immediately upon entering this system, you notice that the local lifeforms are registering as hostile. Even more importantly, you find yourself face-to-face with a Drak Archon. A voice in your head, presumably the Drak Archon, says, "This system is under the protection of the Drak. Leave now, or die, human."'
	npc
		government "Chordi Drak"
		personality heroic vindictive staying
		system "Chordi"
		ship "Archon" "Defensive Nanny"
			
mission "Archon gets hostile"
	invisible
	to offer
		has "Drak guarding Chordi: active"
	npc disable
		government "Test Dummy"
		system "Chordi"
		personality unconstrained heroic nemesis staying
		ship "Timer Ship" "Timer"
		dialog `After a while, you notice the Archon getting very close to your ship. "I shall spare you this once. You will not be so welcome next time," it says to you in your head. It might be good to land somewhere in another system to see why the Archon was so hostile.`
		event "hostile drak"

event "hostile drak"
	"reputation: Chordi Drak" -1
		
mission "Land at Atilt San Pug 1"
	invisible
	destination Atilt San Pug
	to offer
		has "main plot completed"
		has "Drak guarding Chordi: active"
	on enter "Pug Formici"
		set "reputation: Pug" 1
		dialog `Upon entering the system, a Pug ship jumps in as well. It hails you, asking you to land on the only inhabited planet.`
	on complete
		conversation
			`You settle your ship onto a landing pad in what appears to be the Pug's idea of a spaceport. After exiting the <ship>, you are met with a sudden stare from some Pug nearby. One of them takes some device out of it's pocket and speaks into it.`
			`Soon after, a contingent of Pug guards surrounding a single, more formally-dressed, Pug approaches you. You notice that the formally-dressed Pug is holding a cuboid device.`
			`"At last, we meet," it says, speaking into the device, which seems to be a fairly simple translator. "Tell me, <name>, what brings you to Pug space this time?" it asks.`
			`This Pug seems far more talkative than they have previously been. You might be able to get some answers about them if you play its game.`
			choice
				`	"I was exploring nearby and I jumped into a system guarded by an Archon. I'm kind of wondering why the Drak are guarding that system in particular."`
					goto guarded
			choice				
				`	I was exploring space and wanted to see what was inside this system.`
				`	I was exploring space and I jumped into a system containing an Archon. Then I quickly jumped to this system.`
			`	"A Drak Archon is guarding the system known as Chordi. In that system there is a species of what you humans would likely call large ants. We would appreciate your help to nudge along their advancement."`
			`	"We will provide you with a translator for the language of this species," the Pug says, who is now looking at you, waiting for an answer."
			choice
				`	"I will help you."`
					goto help
				`	"I will not help you."`
			`	"Very well. We will give you time to rethink but you are always allowed to land here and help us. When you do wish to help, land here we will provide you with the translator and instructions."`
				goto end
			label help
			`Thank you. Come in and we will explane fearther.`
			label end
			`	The guards walk away from your ship and enter the nearby Spaceport.`

mission "Land at Atilt San Pug 2a"
	invisible
	destination Atilt San Pug
	to offer
		not "has 1 real cloak"
		not "has 1 civ cloak"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug explaining a Cloaking Device (mainly how powerful it is and how necessary it is to get past the Archon) to PC]`
			#`[stuff about Pug giving PC a Cloaking Device]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			outfit "Cloaking Device"
			decline

mission "Land at Atilt San Pug 2b"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		has "has 1 real cloak"
		not "has 2 real cloaks"
		not "has 1 civ cloak"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already HAS a Cloaking Device]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2c"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		has "has 2 real cloaks"
		not "has 1 civ cloak"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC ALREADY has not only 1, but MORE THAN ONE Cloaking Device]`
			#`[choices about whether or not to tell the Pug about Ursa Polaris]`
			#`[possible Pug reactions to different choices mentioned above]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2d"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		not "has 1 real cloak"
		has "has 1 civ cloak"
		not "has 2 civ cloaks"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already has a Cloaking Device, but it's worse than what the Pug have {probably some minor mockery, to boot}]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2e"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		not "has 1 real cloak"
		has "has 2 civ cloaks"
		not "pug intro antfolk"
	on complete
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already has MULTIPLE Cloaking Devices, and that they're all specifically WORSE than what the Pug have {probably some level of mockery to boot}]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2f"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		has "has 1 real cloak"
		not "has 2 real cloaks"
		has "has 1 civ cloak"
		not "has 2 civ cloaks"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already has TWO Cloaking Devices, but one of them is crap compared to what the Pug have {probably some level of mockery to boot}]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2g"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		has "has 1 real cloak"
		not "has 2 real cloaks"
		has "has 2 civ cloaks"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already has MULTIPLE Cloaking Devices, but all but one of them is crap compared to what the Pug have {probably some level of mockery to boot}]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Atilt San Pug 2h"
	invisible
	destination Atilt San Pug
	to offer
		has "Land at Atilt San Pug 1: done"
		has "has 2 real cloaks"
		has "has 2 civ cloaks"
		not "pug intro antfolk"
	on offer
		set "pug intro antfolk"
		conversation
			#`[stuff about PC deciding to help the Pug]`
			#`[stuff about Pug figuring out PC already has MULTIPLE Cloaking Devices, and they're a mix of real, good Cloaking Devices and some sort of crudware Civilian version {probably a ton of mockery to boot, like 'Who even does that?!' or something}]`
			#`[stuff about PC being given translation device and PC's ship's communications systems being modified to be compatible with Antfolk hailing message formats]`
			#`[stuff about PC being taught how to make said modifications to other ships, including the rest of their fleet]`
			decline

mission "Land at Ussria"
	name "First Contact: Antfolk"
	description "Enter the Chordi System while cloaked to make first-contact with the 'Antfolk'"
	source Atilt San Pug
	destination Ussria
	clearance "You try hailing Ussria using the translation device the Pug gave you in conjunction with the modifications they made to your ship's communications systems. The traffic controller panics and leaves their post. You are left waiting for a good five hours before what you think is a different Antfolk comes on and grants permission to land in an open wasteland instead of the spaceport."
	infiltrating
	to offer
		has "Land at Atilt San Pug 2: done"
	on complete
		conversation
			#`[stuff about PC gaining the Antfolk's trust]`
			#`[stuff about the Antfolk wanting Jump Drive tech]`
			#`[at some point, try to explain that the Antfolk language is called 'Assimilated Pheromonal, Anatonmical, and Sonic Language', or 'APASL' for short]`
		"reputation: Antfolk Union" >?=10

mission "Antfolk Hyperdrives Prep 1"
	name "Race Shepharding 101"
	description "Learn about how to best provide new technology to a younger race"
	#source Ussria | I'm not sure I should have this mission require the Player to be on a particular planet. Keeping this here as documentation until I can get a second opinion.
	destination Atilt San Pug
	to offer
		has "Land at Ussria: done"
	on offer
		conversation
			`It occurs to you that you know very little about how Hyperdrives work or how to make them, and even less about Jump Drives. Not to mention that what little you know of the two makes just giving tons of either one to a race that hasn't earned the knowledge for themselves sounds like more of a terrible idea the more you think about it.`
			`You should probably go back to Sevijet Pug and ask the Pug about what to do from here.`
	on complete
		conversation
			#`[PC explains problem to Pug]`
			#`[Pug teach PC about simplified models and giving tech slowly and incrementally]`
			`"So I should give the Antfolk simplified, educational models of Hyperdrives rather than actual Hyperdrives, and *only* give them models for Hyperdrives, nothing else, at least for now," you say, summarizing and clarifying what the Pug said. Then you ask, "But... where am I supposed to find something like that? And how many do I need?"`
			`The Pug smirks. At least, you think it's smirking. "Telling you all of that would defeat the point of you doing this instead of us. If you must have a hint, then I'd recommend contacting one of your species' 'corporations' that manufactures Hyperdrives and see if any of them can - or will - help you. As for how many you need, only the Antfolk scientists looking at such a model may be able to know how many they need in advance."`
			`The Pug turns to leave, then stops, turns back and says "Oh, and feel free to come back after you have given the Antfolk all the Hyperdrive Models they need. It's between them and you what assistance they require next, but you are welcome to visit us and tell us all you have learned when you are between project stages. We might even have advice from time to time. Maybe. But only bother coming if you want to. We're not forcing you to do anything."`

mission "Antfolk Hyperdrives Prep 2"
	name "Find a supplier for Hyperdrive Models"
	description "Find someone who can supply you with educational models of a Hyperdrive."
	to offer
		has "Antfolk Hyperdrives Prep 1"
	on offer
		conversation
			#`[pulls list of major human ship and outfit manufacturing corporations off of ship computer's database]`
			#`[some details about each corporation, ex. the Syndicate have resources, but they are jerks]`
			branch kestrel
				has "Kestrel Testing: done"
			accept
			label kestrel
			#`["Oh yeah, and the Tarazed Corporation probably likes me since they asked me to help with testing their Kestrel warship..."]`
			accept
	stopover Ada
		diolog
			`"Sorry, Lovelace Labs can't help you."`
	stopover Asgard
		diolog
			`"Sorry, Deep Sky can't help you."`
	stopover Rust
		diolog
			`"Sorry, Kraz Cybernetics can't help you."`		stopover Solace
		diolog
			`"Sorry, the Delta V Corporation can't help you."`
	stopover Hephaestus
		diolog
			`"The Syndicate won't help you."`
	stopover Tarazed	
		conversation
			`"Sure, we'll help the great Captain <name>! Here's a spare Hyperdrive Model we used them to train apprentices. Your more than welcome to it."`
		fail

mission "Antfolk Hyperdrive Model 1"
	landing
	name "Deliver a Hyperdrive Model"
	description "Pickup a Hyperdrive Educational Model from <source>, and bring it to the Antfolk on <destination>"
	to offer
		has "Antfolk Hyperdrives Prep 2"
	source "Wayfarer"
	cargo "Hyperdrive Educational Model" 20
	blocked "You need 20 tons of cargo space for the Hyperdrive model"
	on offer
		dialog "Some Tarazed Corp workers load the Hyperdrive Educational Model onto your ship."
	destination "Ussria"
	on complete
		conversation
			`The Antfolk unload the simplified model of a Hyperdrive from your ship and carry it off. You try asking them how many more they think they'll need, but they just look at you and then walk away, carrying the model.`
			`You go back to your ship and try contacting the Antfolk government. You manage to get a response from an "Ambassador [named antfolk sapience 1]" who says "This 'Hyperdrive' you gave us does not [appear/seem] [real/authentic]. It does not [work/function]. What is the meaning of this?"`
			choice
				`"I gave you a simplified educational model of a Hyperdrive,"`
#need more options
			`"Why? What is your [purpose/reasoning] for doing so?" Ambassador [named antfolk sapience 1] asks
			choice
				`"Because real Hyperdrives are dangerous and I wished for you to have something safer to reverse-engineer."`
					goto safer
				#`"Because real Hyperdrives are extremely complicated and I wished for you to have something easier to reverse-engineer."`
					#goto easier
			label safer
				`"How are Hyperdrives dangerous? Are they not [simply/just/only] a [device/tool] of [propulsion/movement]?" Ambassador [named antfolk sapience 1] asks.`
				`"They are meant purely for faster-than-light propulsion, but they do so partly by using a nuclear fusion reaction intense enough to destroy an entire city. Not something you want to turn on while in a terrestrial laboratory," you explain.`
				`"[I/we/this one]... understand. We are [appreciative/thankful] of your [thoughtfulness/prudence] on the matter," Ambassador [named antfolk sapience 1] says slowly.`
				`You think you might've also detected a hint of embarassment or nervousness in Ambassador [named antfolk sapience 1]'s voice. You suspect that they had attempted exactly what you said was a bad idea prior to your call.`
			`"How many more of these Hyperdrive models do you think you'll need?" you ask.`
			`"We will definitely need at least one more. Beyond that, [I/we/this one] cannot be sure."`
		"reputation: Antfolk Union" >?= 20

mission "Antfolk Hyperdrive Model 2"
	name "More Hyperdrive Models"
	description "Pickup another Hyperdrive Educational Model from <stopover> and bring it to the Antfolk on <destination>"
	to offer
		has "Antfolk Hyperdrive Model 1"
	source "Ussria"
	waypoint Tarazed
		stopover Wayfarer
	on stopover
		cargo "Hyperdrive Educational Model" 20
		dialog "Tarazed Corp workers load another <commodity> onto your ship."
	on complete
		conversation
			`The Antfolk unload their second simplified Hyperdrive model from your ship. You decide to contact Ambassador [named antfolk sapience 1] to see if they need more.`
			`By way of radio communication, Ambassador [named antfolk sapience 1] says "Yes, we will need a third. [I/we/this one] must apologize for being unable to provide a total number required. Studying these models is not an exact [science/art], but we will know when we have enough."`

mission "Antfolk Hyperdrive Model 3"
	name "More Hyperdrive Models"
	description "Pickup another Hyperdrive Educational Model from <stopover> and bring it to the Antfolk on <destination>"
	to offer
		has "Antfolk Hyperdrive Model 1"
	source "Ussria"
	waypoint Tarazed
		stopover Wayfarer
	on stopover
		cargo "Hyperdrive Educational Model" 20
		dialog "Tarazed Corp workers load another <commodity> onto your ship."
	on complete
		conversation
			`"This is enough of them. On behalf of the Antfolk Union, [I/we/this one] thank you," says Ambassador [named antfolk sapience 1]`
		event "antfolk gain hyperdrives" 50 #the exact delay is debatable. A year or two perhaps - J

mission "Drak stop guarding Chordi"
	invisible
	landing
	to offer
		has "antfolk gain hyperdrives"
	on offer
		fail "Drak guarding Chordi"